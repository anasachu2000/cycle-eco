const loadSalesReport = async(req,res) =>{
  try {
    const adminData = await User.findById({ _id: req.session.Auser_id });
   const order = await Order.aggregate([
  { $unwind: "$products" },
  { $match: { 'products.status': 'Delivered' } },
  { $sort: { date: -1 } },
  {
    $lookup: {
      from: 'products',
      let: { productId: { $toObjectId: '$products.productid' } },
      pipeline: [
        { $match: { $expr: { $eq: ['$_id', '$$productId'] } } }
      ],
      as: 'products.productDetails'
    }
  },  
  {
    $addFields: {
      'products.productDetails': { $arrayElemAt: ['$products.productDetails', 0] }
    }
  }
]);
    res.render("sales-report", { order ,admin:adminData });
  } catch (error) {
    console.log(error.message);
  }
}
